{"version":3,"file":"server.js","mappings":";;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;ACZA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;ACdA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;ACRA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACXA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;ACxGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;ACZA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;ACfA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;ACRA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;AC/BA;;;;;;;;;;ACAA;;;;;;;;;;ACAA;;;;;;;;;;ACAA;;;;;;;;;;ACAA;;;;;;;;;;ACAA;;;;;;;;;;ACAA;;;;;;;;;;ACAA;;;;;;;;;;ACAA;;;;;;;;;;ACAA;;;;;;;;;;ACAA;;;;;;;;;;ACAA;;;;;;;;;;ACAA;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;ACvBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;ACPA;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;AENA;AACA;AACA;AACA;AACA;AACA","sources":["webpack://react-ssr-demo/./src/containers/App.js","webpack://react-ssr-demo/./src/containers/components/Home.js","webpack://react-ssr-demo/./src/containers/components/User.js","webpack://react-ssr-demo/./src/router/config.js","webpack://react-ssr-demo/./src/server/index.js","webpack://react-ssr-demo/./src/server/template.js","webpack://react-ssr-demo/./src/store/action/index.js","webpack://react-ssr-demo/./src/store/index.js","webpack://react-ssr-demo/./src/store/reducer/index.js","webpack://react-ssr-demo/external commonjs \"axios\"","webpack://react-ssr-demo/external commonjs \"core-js/stable\"","webpack://react-ssr-demo/external commonjs \"koa\"","webpack://react-ssr-demo/external commonjs \"koa-body\"","webpack://react-ssr-demo/external commonjs \"koa-static\"","webpack://react-ssr-demo/external commonjs \"react\"","webpack://react-ssr-demo/external commonjs \"react-dom/server\"","webpack://react-ssr-demo/external commonjs \"react-redux\"","webpack://react-ssr-demo/external commonjs \"react-router-dom\"","webpack://react-ssr-demo/external commonjs \"react-router-dom/server\"","webpack://react-ssr-demo/external commonjs \"redux\"","webpack://react-ssr-demo/external commonjs \"regenerator-runtime/runtime\"","webpack://react-ssr-demo/external node-commonjs \"path\"","webpack://react-ssr-demo/webpack/bootstrap","webpack://react-ssr-demo/webpack/runtime/compat get default export","webpack://react-ssr-demo/webpack/runtime/define property getters","webpack://react-ssr-demo/webpack/runtime/hasOwnProperty shorthand","webpack://react-ssr-demo/webpack/runtime/make namespace object","webpack://react-ssr-demo/webpack/before-startup","webpack://react-ssr-demo/webpack/startup","webpack://react-ssr-demo/webpack/after-startup"],"sourcesContent":["import React from 'react';\nimport { Routes, Route, NavLink } from 'react-router-dom';\nimport { routes } from '../router/config';\nexport var App = function App() {\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Routes, null, routes.map(function (route) {\n    return /*#__PURE__*/React.createElement(Route, {\n      path: route.path,\n      key: route.name,\n      element: route.component\n    });\n  })));\n};\nexport default App;","import React, { useEffect, useState } from 'react';\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { addAgeAction } from '../../store/action';\nexport var Home = function Home() {\n  var dispatch = useDispatch();\n  var state = useSelector(function (state) {\n    return state;\n  });\n  return /*#__PURE__*/React.createElement(\"div\", null, /*#__PURE__*/React.createElement(\"p\", null, \"name: \", state.name), /*#__PURE__*/React.createElement(\"p\", null, \" age:\", state.age), /*#__PURE__*/React.createElement(\"button\", {\n    onClick: function onClick() {\n      dispatch(addAgeAction());\n    }\n  }, \"add\"));\n};\nexport default Home;","import React, { useEffect } from 'react';\nimport { useSelector } from \"react-redux\";\nexport var User = function User() {\n  var state = useSelector(function (state) {\n    return state;\n  });\n  return /*#__PURE__*/React.createElement(\"div\", null, /*#__PURE__*/React.createElement(\"p\", null, \"name:\", state.name), /*#__PURE__*/React.createElement(\"p\", null, \"age:\", state.age));\n};\nexport default User;","import Home from \"../containers/components/Home\";\nimport User from \"../containers/components/User\";\nimport React from \"react\";\nexport var routes = [{\n  name: 'Home',\n  path: '/',\n  component: /*#__PURE__*/React.createElement(Home, null)\n}, {\n  name: 'User',\n  path: '/user',\n  component: /*#__PURE__*/React.createElement(User, null)\n}];","function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\n\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\n\nimport Koa from 'koa';\nimport koaBody from 'koa-body';\nimport koaStatic from 'koa-static';\nimport path from \"path\";\nimport React from 'react';\nimport { renderToString } from 'react-dom/server';\nimport App from \"../containers/App\";\nimport { StaticRouter } from \"react-router-dom/server\";\nimport { Provider, useDispatch } from \"react-redux\";\nimport { getServerStore } from \"../store\";\nimport axios from \"axios\";\nimport { modifyUserAction } from \"../store/action\";\nimport { getTemplate } from \"./template\";\nvar app = new Koa();\napp.use(koaStatic(path.join(__dirname, '../public'))); // 请求体 parse 中间件，用于 parse json 格式请求体\n\napp.use(koaBody());\napp.use( /*#__PURE__*/function () {\n  var _errorHandler = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(ctx, next) {\n    return regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.prev = 0;\n            _context.next = 3;\n            return next();\n\n          case 3:\n            _context.next = 10;\n            break;\n\n          case 5:\n            _context.prev = 5;\n            _context.t0 = _context[\"catch\"](0);\n            // 抛出的错误可以附带 status 字段，代表 http 状态码\n            // 若没有提供，则默认状态码为 500，代表服务器内部错误\n            console.log(_context.t0);\n            ctx.status = _context.t0.status || 500;\n            ctx.body = {\n              success: false,\n              message: _context.t0.message\n            };\n\n          case 10:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, null, [[0, 5]]);\n  }));\n\n  function errorHandler(_x, _x2) {\n    return _errorHandler.apply(this, arguments);\n  }\n\n  return errorHandler;\n}());\napp.use( /*#__PURE__*/function () {\n  var _ref = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2(ctx) {\n    var url, store, _yield$axios$get, data;\n\n    return regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            url = ctx.request.url;\n\n            if (!url.includes('.')) {\n              _context2.next = 4;\n              break;\n            }\n\n            ctx.body = '';\n            return _context2.abrupt(\"return\", false);\n\n          case 4:\n            store = getServerStore();\n            _context2.next = 7;\n            return axios.get('http://localhost:4000');\n\n          case 7:\n            _yield$axios$get = _context2.sent;\n            data = _yield$axios$get.data;\n            store.dispatch(modifyUserAction(data.name, data.age));\n            ctx.body = getTemplate(url, store);\n\n          case 11:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n\n  return function (_x3) {\n    return _ref.apply(this, arguments);\n  };\n}());\napp.listen(3001, function () {\n  console.log('http://localhost:3001/ start');\n});","import { renderToString } from \"react-dom/server\";\nimport { Provider } from \"react-redux\";\nimport { StaticRouter } from \"react-router-dom/server\";\nimport App from \"../containers/App\";\nimport React from \"react\";\nexport function getTemplate(url, store) {\n  var content = renderToString( /*#__PURE__*/React.createElement(Provider, {\n    store: store\n  }, /*#__PURE__*/React.createElement(StaticRouter, {\n    location: url\n  }, /*#__PURE__*/React.createElement(App, null))));\n  return \"\\n   <html>\\n     <head>\\n       <title>hello</title>\\n     </head>\\n     <body>\\n      <div id=\\\"root\\\">\".concat(content, \"</div>\\n     </body>\\n     <script>\\n        window.context = {\\n            state: \").concat(JSON.stringify(store.getState()), \"\\n          } \\n    </script>\\n     <script  src=\\\"./client.js\\\"></script>\\n   </html>\\n \");\n}","export var ADD_AGE = 'ADD_AGE';\nexport var MODIFY_Info = 'MODIFY_Info';\nexport var addAgeAction = function addAgeAction() {\n  return {\n    type: ADD_AGE\n  };\n};\nexport var modifyUserAction = function modifyUserAction(name, age) {\n  return {\n    type: MODIFY_Info,\n    payload: {\n      name: name,\n      age: age\n    }\n  };\n};","import { createStore } from 'redux';\nimport { reducer } from './reducer';\nexport function getClientStore() {\n  var initState = window.context.state;\n  return createStore(reducer, initState);\n}\nexport function getServerStore() {\n  return createStore(reducer);\n}","function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { ADD_AGE, MODIFY_Info } from '../action';\nvar defaultState = {\n  name: \"\",\n  age: 0\n};\nexport var reducer = function reducer() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : defaultState;\n  var action = arguments.length > 1 ? arguments[1] : undefined;\n\n  switch (action.type) {\n    case ADD_AGE:\n      return _objectSpread(_objectSpread({}, state), {}, {\n        age: state.age + 1\n      });\n\n    case MODIFY_Info:\n      return _objectSpread(_objectSpread({}, state), {}, {\n        age: action.payload.age,\n        name: action.payload.name\n      });\n\n    default:\n      return state;\n  }\n};\nexport default reducer;","module.exports = require(\"axios\");","module.exports = require(\"core-js/stable\");","module.exports = require(\"koa\");","module.exports = require(\"koa-body\");","module.exports = require(\"koa-static\");","module.exports = require(\"react\");","module.exports = require(\"react-dom/server\");","module.exports = require(\"react-redux\");","module.exports = require(\"react-router-dom\");","module.exports = require(\"react-router-dom/server\");","module.exports = require(\"redux\");","module.exports = require(\"regenerator-runtime/runtime\");","module.exports = require(\"path\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","","// startup\n// Load entry module and return exports\n// This entry module used 'module' so it can't be inlined\n__webpack_require__(\"core-js/stable\");\n__webpack_require__(\"regenerator-runtime/runtime\");\nvar __webpack_exports__ = __webpack_require__(\"./src/server/index.js\");\n",""],"names":[],"sourceRoot":""}